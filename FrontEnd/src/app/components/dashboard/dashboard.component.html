<div class="container-fluid">
  <span (click)="closePanel();isWidgetOpen=true" *ngIf="!isWidgetOpen" class="openWidget">
    <mat-icon color="primary">open_with</mat-icon>

  </span>



  <div cdkDropListGroup *ngIf="!hide" class="row">




    <div [style.height.px]="widgetPanelHeight" [ngClass]="{'col-md-9':isWidgetOpen,'col-md-12':!isWidgetOpen}"
      class="widgetDraggedPanel ">



      <div id="layout-container">
        <div *ngIf="hide" class="example-container">

          <div class="top-list mt-2" cdkDropList #divBoard [cdkDropListData]="draggedWidget$"
            cdkDropListSortingDisabled="true" (cdkDropListDropped)="drop($event)">

            <div class="init-text" *ngIf="draggedWidget$.length==0">
              Drag & drop the Widgets
            </div>

            <div #widgetIndex [cdkDragDisabled]="List.dragDisabled" [style.width.px]="service.getProp('W',List)"
              [style.height.px]="service.getProp('H',List)" [style.top.px]="service.getProp('t',List)"
              [style.left.px]="service.getProp('l',List)" cdkDrag class="widget-box example-box"
              *ngFor="let List of draggedWidget$ ;index as idx">

              <div class="init-text" *ngIf="!List">
                Drag & drop the Widgets
              </div>
              <!-- <span appWidgetAccessIf *ngIf="List" class="mapped-close">
                <mat-icon color="accent" matTooltip="{{List.dragDisabled?'Drag disabled':'Drag enabled'}}"
                 (click)="List.dragDisabled=!List.dragDisabled"> 
                  {{List.dragDisabled?'layers_clear':'layers'}}</mat-icon>

                <mat-icon (click)="editRequest(List)" matTooltip="Edit Widget" color="primary">edit</mat-icon>

                <mat-icon (click)="removeRequest(List)" matTooltip="Remove Widget" color="warn">delete_outline</mat-icon>

              </span>  -->
              <div *ngIf="List && List.WIDGET_TYPE==='CHARTS'">


                <app-plotly [positionTop]="List.top" [positionLeft]="List.left" (_widgetData)="saveWidget($event)"
                  [widgetIndex]="idx" [WIDGET_REQUEST]="List"></app-plotly>


                <!-- <div class="my-card-footer2">
                <mat-label>Asset Config:{{List.CONFIG_NAME}}</mat-label>

              </div> -->

              </div>
            </div>

          </div>
        </div>


        <!-- now -->
        <ng-container *ngIf="!hide">
          <div class="row1" cdkDropList #divBoard [cdkDropListData]="draggedWidget$"
            (cdkDropListDropped)="onDrop($event)">


            <div (cdkDragStarted)="dragStarted($event)" (cdkDragEnded)="dragEnded($event,List)"
              (cdkDragMoved)="dragMoved($event,List)" cdkDrag [cdkDragDisabled]="List.dragDisabled"
              [ngClass]="{'col-md-12 ':!List,'col-md-12':!List}" class=""
              *ngFor="let List of draggedWidget$;index as idx">

              <div [ngClass]="{'draggedEmpty minWidgetHight':!List}" class="rowd example-box1 resizable1 listed-charts">

                <!-- <span class="savewidget" (_widgetData)="saveWidget($event)">
                  <mat-icon color="accent">save</mat-icon>
          
              </span> -->

                <div class="init-text" *ngIf="!List">
                  Drag & drop the Widgets
                </div>


                <!-- <span appWidgetAccessIf *ngIf="List!='0'" class="mapped-close">
                  <mat-icon color="accent" matTooltip="{{dragDisabledArr[idx].dragDisabled?'Drag disabled':'Drag enabled'}}"
                   (click)="dragDisabledArr[idx].dragDisabled=!dragDisabledArr[idx].dragDisabled"> 
                    {{dragDisabledArr[idx].dragDisabled?'layers_clear':'layers'}}</mat-icon>

                  <mat-icon (click)="editRequest(List)" matTooltip="Edit Widget" color="primary">edit</mat-icon>

                  <mat-icon (click)="removeRequest(List)" matTooltip="Remove Widget" color="warn">delete_outline</mat-icon>

                </span> -->

                <div *ngIf="List.WIDGET_TYPE=='HIGHLIGHTS'">

                  <app-highlights [widgetIndex]="idx" (_widgetData)="saveWidget($event)" [WIDGET_REQUEST]="List">
                  </app-highlights>

                </div>
                <div class="" *ngIf="List.WIDGET_TYPE==='TABLE'">

                  <app-table (_widgetData)="saveWidget($event)" [WIDGET_REQUEST]="List">
                  </app-table>

                </div>
                <div *ngIf="List.WIDGET_TYPE==='MAPS'">



                  <app-map [widgetIndex]="idx" (_widgetData)="saveWidget($event)" [WIDGET_REQUEST]="List"></app-map>

                </div>
                <ng-container *ngIf="List.WIDGET_TYPE=='CHARTS'">

                  <app-plotly  (_widgetRemoved)="widgetRemoved($event)" [positionTop]="List.top"
                    [positionLeft]="List.left" (_widgetData)="saveWidget($event)" [widgetIndex]="idx"
                    [WIDGET_REQUEST]="List"></app-plotly>

                  <!-- <div class="my-card-footer2">
                    <mat-label>Asset Config:{{List.CONFIG_NAME}}</mat-label>

                  </div> -->

                </ng-container>
                <div class="card" *ngIf="List.WIDGET_TYPE==='SUMMARY'">

                  <app-card [WIDGET_REQUEST]="List"></app-card>
                  <!-- <mat-spinner></mat-spinner> -->
                  <!-- <div class="my-card-footer2">
                      <mat-label>Asset Config:{{getRequestDetails(List,'config')}}</mat-label>

                    </div> -->

                </div>

              </div>

            </div>

          </div>
        </ng-container>
      </div>


      <!-- 
      <div class="footer-container">
        <button  mat-raised-button color="primary">Expand Layout</button>

        <button mat-raised-button color="warn">Minimize Layout</button>
      </div> -->

    </div>


    <div *ngIf="isWidgetOpen" [style.height.px]="widgetPanelHeight" [ngClass]="{'col-md-3':isWidgetOpen}"
      class="widget-panel ">

      <div appWidgetAccessIf class="footer-container">
        <button (click)="expandLayout()" mat-raised-button color="primary">Expand Layout</button>

        <button (click)="minLayout()" mat-raised-button color="warn">Minimize Layout</button>
      </div>

      <span (click)="closePanel();isWidgetOpen=false" class="closed">
        <mat-icon color="primary">close</mat-icon>

      </span>
      <div class="sticky-top">

        <!-- <mat-toolbar  style="background-color: transparent;text-align:left" color="none"> -->

        <button *appAccessrights="false" mat-raised-button color="primary" (click)="openDialog()"
          class="demo-button mt-1">
          Create Widget
        </button>

        <!-- </mat-toolbar> -->

        <mat-grid-list class="mt-3" color="primary" cols="2" rowHeight="2:2">
          <form style="background:#fff;padding:5px" [formGroup]="newForm">

            <mat-grid-list cols="10">

              <mat-form-field appearance="standard">
                <mat-label style="color:#444" color="dark">SELECT COMPANY</mat-label>
                <mat-select (selectionChange)="getMappedChartRequest()" formControlName="COMPANY_ID">

                  <mat-option *ngFor="let key of companiesList" [value]="key.PID">
                    {{key.COMPANY_NAME}}
                  </mat-option>

                </mat-select>
              </mat-form-field>

            </mat-grid-list>
          </form>
          <mat-label>Available Widgets( {{undraggedWidget$.length}} )</mat-label>


          <!-- <div cdkDropList #moviesList="cdkDropList" [cdkDropListData]="undraggedWidget"
            [cdkDropListConnectedTo]="[doneMovieList]" class="example-list2" (cdkDropListDropped)="onDrop($event)">
            <div class="Widget-block" [cdkDragData]="List" *ngFor="let List of undraggedWidget" cdkDrag>

              <mat-card class="listed-charts undraggedBlock" color="primary">

                <span appWidgetAccessIf class="mapped-close">
                  <mat-icon (click)="editRequest(List)" color="accent">edit</mat-icon>
                  <mat-icon (click)="removeRequest(List)" color="warn">delete_outline</mat-icon>
                </span>
                <mat-card-subtitle>
                  {{getRequestDetails(List,'n')}} of {{getRequestDetails(List,'config')}}
                </mat-card-subtitle>
                <mat-card-content>
                  {{getRequestDetails(List,'d')}}

                  <img class="" src="assets/{{getRequestDetails(List,'IMG')}}.png" />


                </mat-card-content>
              </mat-card>
            </div>
          </div> -->




          <div cdkDropList #widgetList="cdkDropList" [cdkDropListData]="undraggedWidget$" class="example-list2"
            (cdkDropListDropped)="onDrop($event)">
            <div class="Widget-block" [cdkDragData]="List" *ngFor="let List of undraggedWidget$" cdkDrag>

              <mat-card class="listed-charts undraggedBlock" color="primary">

                <span appWidgetAccessIf class="mapped-close">
                  <mat-icon (click)="editRequest(List)" color="accent">edit</mat-icon>
                  <mat-icon (click)="removeRequest(List)" color="warn">delete_outline</mat-icon>
                </span>
                <mat-card-subtitle>
                  {{List.WIDGET_TYPE}} of {{List.CONFIG_NAME}}
                </mat-card-subtitle>
                <mat-card-content>
                  {{List.WIDGET_DATA}}

                  <img class="" src="assets/{{List.WIDGET_IMG}}.png" />


                </mat-card-content>
              </mat-card>
            </div>
          </div>

        </mat-grid-list>





      </div>

    </div>
  </div>
</div>